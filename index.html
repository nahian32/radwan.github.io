<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>Happy Birthday ‚Äî My MOON</title>
  <style>
    /* --- INTRO & COUNTDOWN STYLES (Added) --- */
    #intro-overlay {
      position: fixed; inset: 0; z-index: 9999;
      background: #fff0f6;
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center;
      font-family: "Segoe UI", system-ui, sans-serif;
    }
    .intro-btn {
      padding: 15px 40px; font-size: 22px; background: #e14986; color: white;
      border: none; border-radius: 50px; cursor: pointer; font-weight: bold;
      box-shadow: 0 10px 20px rgba(225, 73, 134, 0.3);
      animation: pulse 1.5s infinite;
    }
    .intro-content { display: none; opacity: 0; animation: fadeIn 1s forwards; }
    .intro-text { font-size: 24px; color: #e14986; margin-bottom: 20px; font-weight: 700; }
    .smiley { 
      display: inline-block; font-size: 50px; 
      animation: smileBounce 1s infinite alternate; 
    }
    .intro-count { 
      font-size: 100px; font-weight: 900; color: #4c7df0; 
      margin-top: 20px; display: block;
    }

    @keyframes pulse { 0%{transform:scale(1)} 50%{transform:scale(1.05)} 100%{transform:scale(1)} }
    @keyframes smileBounce { from{transform: translateY(0) rotate(0deg);} to{transform: translateY(-15px) rotate(10deg);} }
    @keyframes fadeIn { to{opacity: 1;} }
    @keyframes fadeOverlay { to{opacity:0; visibility:hidden;} }

    /* --- YOUR ORIGINAL CSS (Kept Intact) --- */
    body {
    background: linear-gradient(180deg, #ffeaf4, #d6f0ff);
    animation: bgShift 20s infinite alternate;
  }
  @keyframes bgShift {
    0% { background: linear-gradient(180deg, #ffeaf4, #d6f0ff); }
    100% { background: linear-gradient(180deg, #d6fff0, #ffe6f9); }
  }
  
    :root{
      --bg1:#ffd1e6; --bg2:#ffe9f5; --accent:#4c7df0; --accent-2:#ff7aa2; --text:#402c3c; --white:#fff;
      --gold:#f7d776; --shadow:0 10px 25px rgba(0,0,0,.18); --soft-shadow:0 6px 20px rgba(0,0,0,.12);
      --confetti1:#ff6f91; --confetti2:#ffdd59; --confetti3:#70e0a3; --confetti4:#7aa2ff;
    }
    *{box-sizing:border-box} html,body{height:100%;margin:0}
    body{
      font-family: "Segoe UI", system-ui, -apple-system, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background:
        radial-gradient(1200px 500px at 20% -10%, #fff0f6 15%, transparent 60%),
        radial-gradient(800px 300px at 80% 110%, #ffeaf4 15%, transparent 60%),
        linear-gradient(180deg, var(--bg2), var(--bg1));
      overflow-x:hidden;
    }

    /* Header */
    .header{position:relative; padding:20px 16px 12px; display:flex; align-items:center; justify-content:center; z-index: 10;}
    .header__banner{display:flex; align-items:center; gap:12px; padding:8px 16px; border-radius:14px; background: rgba(255,255,255,.55); backdrop-filter: blur(6px); box-shadow: var(--soft-shadow);}
    .header__title{font-weight:800; letter-spacing:.6px; font-size: clamp(20px, 4vw, 30px); color:#e14986; text-shadow:0 2px 0 rgba(255,255,255,.9)}

    /* Lights */
    .lights{position:absolute; top:0; left:0; right:0; height:70px; display:flex; justify-content:center; gap:20px; pointer-events:none; z-index: 5;}
    .bulb{width:12px;height:12px;border-radius:50%;box-shadow:0 0 12px rgba(255,255,255,.7), 0 0 30px currentColor inset; animation:twinkle 2.8s ease-in-out infinite}
    .bulb:nth-child(1){color:#ff7aa2;animation-delay:.1s} .bulb:nth-child(2){color:#70e0a3;animation-delay:.6s}
    .bulb:nth-child(3){color:#ffd166;animation-delay:1.2s} .bulb:nth-child(4){color:#7aa2ff;animation-delay:1.7s}
    .bulb:nth-child(5){color:#f78fb3;animation-delay:2.2s}
    @keyframes twinkle{0%,100%{opacity:.45;transform:translateY(0)}50%{opacity:1;transform:translateY(3px)}}

    /* Stage */
    .stage{position:relative; width:100%; max-width:1200px; margin:0 auto; padding:12px 16px 120px; min-height:calc(100vh - 160px); overflow:hidden}

    /* Confetti */
    .confetti{position:absolute; inset:0; pointer-events:none}
    .piece{position:absolute; width:6px; height:12px; border-radius:2px; opacity:.9; transform:rotate(0deg) translateY(-40px); animation:fall linear forwards}
    @keyframes fall{0%{transform:translateY(-40px) rotate(0deg)} 100%{transform:translateY(110vh) rotate(720deg)}}

    /* Background floating messages */
    .messages{position:absolute; inset:0; pointer-events:none; z-index:3}
    .msg{position:absolute; background:#fdf7ff; color:#a04a7a; border:1px solid rgba(224,73,134,.15); padding:6px 10px; border-radius:14px;
      font-size: clamp(11px, 2.4vw, 14px); box-shadow: 0 8px 20px rgba(164,74,122,.12); opacity:0; transform:translateY(40px) scale(.95);
      animation:drift 7s ease-in-out forwards; white-space:nowrap}
    @keyframes drift{
      0%{opacity:0;transform:translateY(40px) scale(.95)}
      10%{opacity:.8}
      50%{opacity:1;transform:translateY(-40px) scale(1)}
      100%{opacity:0;transform:translateY(-120px) scale(1.05)}
    }

    /* Balloons container */
    .balloons{position:absolute; left:0; right:0; bottom:8%; display:flex; flex-wrap:wrap; gap:18px; justify-content:center; z-index:4; transition: transform 1s ease, bottom 1s ease;}
    .balloons.gather{bottom:30%; transform:scale(1.02)}
    .balloon{
      position:relative; width:min(26vw,150px); height:min(26vw,150px);
      display:grid; place-items:center; border-radius:50%;
      box-shadow:var(--shadow);
      animation:float 6s ease-in-out infinite;
      /* will be painted per-balloon via CSS vars */
      background: radial-gradient(circle at 30% 25%, var(--balloon-light,#fff) 0%, var(--balloon-mid,#ffd6ea) 30%, var(--balloon-base,#ffb3d2) 65%, var(--balloon-deep,#f288b6) 100%);
    }
    .balloon::after{content:""; position:absolute; bottom:-28px; left:50%; width:2px; height:40px; background:#c9a2b5; transform:translateX(-50%)}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-16px)}}
    .face{width:84%; height:84%}

    /* Balloon wandering path */
    .wander{
      animation: wander var(--wander-dur,12s) ease-in-out infinite;
    }
    @keyframes wander{
      0%{transform:translate(0,0) rotate(0deg)}
      20%{transform:translate(20px,-14px) rotate(-2deg)}
      40%{transform:translate(-26px,-8px) rotate(3deg)}
      60%{transform:translate(18px,10px) rotate(-3deg)}
      80%{transform:translate(-16px,18px) rotate(2deg)}
      100%{transform:translate(0,0) rotate(0deg)}
    }

    /* Balloon speech bubble message */
    .bubble-msg{
      position:absolute; top:-14px; left:50%; transform:translateX(-50%); background:#fff; color:#e14986; border:1px solid rgba(225,73,134,.25);
      border-radius:12px; padding:6px 8px; font-size:12px; box-shadow:var(--soft-shadow); white-space:nowrap; opacity:.95;
    }
    .bubble-msg::after{
      content:""; position:absolute; bottom:-8px; left:50%; transform:translateX(-50%);
      width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:8px solid #fff;
    }

    /* Chat bubble */
    .chat{position:absolute; left:50%; top:20%; transform:translateX(-50%) scale(.9); background:#fff; border:1px solid rgba(64,44,60,.12);
      border-radius:18px; padding:10px 14px; box-shadow:var(--soft-shadow); display:none; z-index:6; animation:pop .5s ease forwards}
    .chat::after{content:""; position:absolute; bottom:-10px; left:50%; transform:translateX(-50%); width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-top:10px solid #fff; filter: drop-shadow(0 3px 2px rgba(0,0,0,.08))}
    .chat__title{font-weight:800; color:#e14986} .chat__sub{font-size:13px; color:#7a5870}
    @keyframes pop{0%{opacity:0; transform:translateX(-50%) scale(.8)}100%{opacity:1; transform:translateX(-50%) scale(1)}}

    /* Cake area */
    .cake-area{position:absolute; left:0; right:0; bottom:14%; display:grid; place-items:center; z-index:5}
    .cake{position:relative; width:min(68vw,460px); height:min(40vw,260px); display:none}
    .cake__stand{position:absolute; bottom:0; left:50%; transform:translateX(-50%); width:60%; height:14%; background: linear-gradient(180deg, #ffe8f5, #f3c2da); border-radius:12px 12px 20px 20px; box-shadow:var(--shadow)}
    .cake__plate{position:absolute; bottom:12%; left:50%; transform:translateX(-50%); width:72%; height:10%; background:#fff; border:1px solid rgba(64,44,60,.1); border-radius:40px; box-shadow:var(--soft-shadow)}
    .cake__body{position:absolute; bottom:20%; left:50%; transform:translateX(-50%); width:68%; height:50%; background:linear-gradient(180deg,#ffe0ed 0 40%, #ffb3d2 40% 70%, #f39fc7 70% 100%); border-radius:18px; box-shadow:var(--shadow); overflow:hidden}
    .cake__frost{position:absolute; top:-6px; left:0; right:0; height:18px; background: radial-gradient(circle at 20% 0, #fff 20%, transparent 22%) repeat-x; background-size:28px 18px; filter: drop-shadow(0 2px 0 rgba(255,255,255,.9))}
    .candles{position:absolute; bottom: calc(20% + 42%); left:50%; transform:translateX(-50%); display:flex; gap:22px;}
    .candle{width:16px; height:48px; border-radius:6px; background: linear-gradient(180deg, #ffd166, #ff9f1a); position:relative; box-shadow:0 2px 8px rgba(0,0,0,.15)}
    .flame{position:absolute; top:-16px; left:50%; transform:translateX(-50%); width:12px; height:18px; background: radial-gradient(closest-side, #fff 20%, #ffd166 60%, #ff7f50 100%); border-radius:10px; filter: drop-shadow(0 0 8px rgba(255,127,80,.8)); animation:flicker .25s infinite alternate}
    .flame.off{opacity:0; animation:none; filter:none}
    @keyframes flicker{0%{transform:translateX(-50%) scale(1); opacity:1}100%{transform:translateX(-50%) scale(.9); opacity:.85}}

    /* Knife + wedge slice */
    .knife{position:absolute; width:160px; height:26px; right:10%; bottom:55%; transform-origin:right center; transform:rotate(18deg) translateX(0); display:none; z-index:7}
    .knife .blade{position:absolute; left:0; top:0; width:120px; height:12px; background:linear-gradient(90deg,#cdd2d6,#f1f3f5); border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,.2)}
    .knife .handle{position:absolute; right:0; top:-2px; width:40px; height:18px; background:#533d4a; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.25)}
    .wedge{position:absolute; bottom:20%; left:50%; width:0; height:0; transform:translateX(-50%) translateY(0) rotate(0deg); display:none; z-index:6}
    .wedge:before{content:""; position:absolute; width:0; height:0; border-left:60px solid transparent; border-right:60px solid transparent; border-top:120px solid #ffb3d2; filter: drop-shadow(0 10px 20px rgba(0,0,0,.18)); border-radius:8px}
    .wedge:after{content:""; position:absolute; top:-6px; left:-60px; width:120px; height:12px; background:#fff; border-radius:8px; filter: drop-shadow(0 2px 0 rgba(255,255,255,.9))}
    .cake.cutting .knife{display:block; animation:knifeCut 1.6s ease forwards}
    @keyframes knifeCut{
      0%{transform:rotate(18deg) translateX(0)}
      30%{transform:rotate(-10deg) translateX(-20px)}
      50%{transform:rotate(-16deg) translateX(-40px)}
      80%{transform:rotate(-14deg) translateX(-60px)}
      100%{transform:rotate(-12deg) translateX(-60px)}
    }
    .cake.slice-out .wedge{display:block; animation:wedgeLift 1.6s ease forwards}
    @keyframes wedgeLift{
      0%{transform:translateX(-50%) translateY(0) rotate(0deg)}
      40%{transform:translateX(-60%) translateY(-8px) rotate(-3deg)}
      80%{transform:translateX(-80%) translateY(-28px) rotate(-8deg)}
      100%{transform:translateX(-90%) translateY(-40px) rotate(-10deg)}
    }

    /* Controls */
    .controls{position:fixed; left:0; right:0; bottom:0; background: rgba(255,255,255,.78); backdrop-filter: blur(8px); box-shadow: 0 -8px 20px rgba(0,0,0,.08); padding:12px 14px; display:flex; flex-wrap:wrap; gap:10px; justify-content:center; z-index:10}
    .btn{border:none; border-radius:12px; padding:10px 14px; font-weight:700; letter-spacing:.3px; box-shadow:var(--soft-shadow); background:var(--accent); color:#fff; transition: transform .12s ease, box-shadow .2s ease, background .2s ease; cursor:pointer}
    .btn.secondary{ background:#ff7aa2 } .btn.ghost{ background:#fff; color:#e14986; border:1px solid rgba(225,73,134,.2) }
    .btn:active{ transform: scale(.98) } .btn:focus{ outline:2px solid #a7c1ff; outline-offset:2px }

    /* CTA */
    .cta{position:absolute; left:50%; bottom:6%; transform:translateX(-50%); display:none}
    .cta .btn{ background:#4c7df0 }

    /* Dialogue panel */
    .dialogue{position:absolute; left:50%; bottom:28%; transform:translateX(-50%); background:#fff; border:1px solid rgba(64,44,60,.1); border-radius:14px; box-shadow:var(--soft-shadow); padding:10px 12px; display:none; z-index:7; max-width:min(86vw,560px)}
    .dialogue .line{font-size:14px; color:#4b3950; margin:4px 0}
    .dialogue .who{font-weight:700; color:#e14986; margin-right:6px}

    @media (max-width:640px){
      .balloons{ gap:14px }
      .candles{ gap:16px }
      .chat{ top:18%; max-width:90% }
      .dialogue{ bottom:24% }
    }
  </style>
</head>
<body>

  <!-- Audio Files -->
  <audio id="sound-blow" src="blow.mp3" preload="auto"></audio>
  <audio id="sound-pop" src="pop.mp3" preload="auto"></audio>
  <audio id="sound-happy" src="happy.mp3" preload="auto" loop></audio>

  <!-- NEW INTRO OVERLAY -->
  <div id="intro-overlay">
    <button id="btn-start-intro" class="intro-btn">Click for Surprise üéÅ</button>
    <div class="intro-content" id="intro-content">
      <div class="intro-text">
        Hear is a small thanks for my cutieee <span class="smiley">‚ò∫Ô∏è</span>
      </div>
      <span class="intro-count" id="count-display">1</span>
    </div>
  </div>

  <!-- Lights -->
  <div class="lights" aria-hidden="true">
    <div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div><div class="bulb"></div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header__banner">
      <div class="header__title">HAPPY BIRTHDAY</div>
    </div>
  </header>

  <!-- Stage -->
  <main class="stage" role="main">
    <div class="confetti" id="confetti"></div>
    <div class="messages" id="messages" aria-hidden="true"></div>

    <!-- Balloons -->
    <section class="balloons" id="balloons" aria-label="Emoji balloons">
      <div class="balloon wander" data-mood="happy" style="--balloon-light:#fff;--balloon-mid:#ffe1f1;--balloon-base:#ffb3d2;--balloon-deep:#f288b6;--wander-dur:11s">
        <div class="bubble-msg">my mams bithday today</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="transparent"/>
          <circle cx="35" cy="40" r="6" fill="#402c3c"/><circle cx="65" cy="40" r="6" fill="#402c3c"/>
          <path d="M30 62 Q50 75 70 62" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="winky" style="--balloon-light:#fff;--balloon-mid:#ffd6ea;--balloon-base:#ffa7d1;--balloon-deep:#ff7ab5;--wander-dur:13s">
        <div class="bubble-msg">my cutiee my wiffyyy</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="transparent"/>
          <circle cx="35" cy="40" r="6" fill="#402c3c"/>
          <path d="M60 40 h16" stroke="#402c3c" stroke-width="5" stroke-linecap="round"/>
          <path d="M30 64 Q50 78 70 64" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="love" style="--balloon-light:#fff;--balloon-mid:#ffd1f0;--balloon-base:#ff98c8;--balloon-deep:#ff66a8;--wander-dur:12s">
        <div class="bubble-msg">my swityyy</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="transparent"/>
          <path d="M30 38 q5-8 12 0 q-6 8 -12 0" fill="#e14986"/>
          <path d="M58 38 q5-8 12 0 q-6 8 -12 0" fill="#e14986"/>
          <path d="M30 62 Q50 74 70 62" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="surprised" style="--balloon-light:#fff;--balloon-mid:#e4d6ff;--balloon-base:#bfa9ff;--balloon-deep:#9a83ff;--wander-dur:10s">
        <div class="bubble-msg">my mams bithday to day</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="transparent"/>
          <circle cx="35" cy="40" r="6" fill="#402c3c"/><circle cx="65" cy="40" r="6" fill="#402c3c"/>
          <circle cx="50" cy="62" r="8" fill="#402c3c"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="sleepy" style="--balloon-light:#fff;--balloon-mid:#d7ffd9;--balloon-base:#9ef0a8;--balloon-deep:#6bd983;--wander-dur:14s">
        <div class="bubble-msg">moon nap then cake?</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="transparent"/>
          <path d="M28 40 q7 6 14 0" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
          <path d="M58 40 q7 6 14 0" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
          <path d="M30 62 Q50 68 70 62" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="angry" style="--balloon-light:#fff;--balloon-mid:#ffd7d7;--balloon-base:#ff9a9a;--balloon-deep:#ff6e6e;--wander-dur:12.5s">
        <div class="bubble-msg">where‚Äôs the cade!!</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="50" cy="50" r="45" fill="transparent"/>
          <path d="M28 35 q8 -6 14 0" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
          <path d="M58 35 q8 -6 14 0" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
          <path d="M30 64 Q50 56 70 64" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
        </svg>
      </div>

      <!-- Extra funny faces -->
      <div class="balloon wander" data-mood="cool" style="--balloon-light:#fff;--balloon-mid:#d9f1ff;--balloon-base:#9fd3ff;--balloon-deep:#6bb7ff;--wander-dur:11.5s">
        <div class="bubble-msg">we cool we party</div>
        <svg class="face" viewBox="0 0 100 100">
          <rect x="24" y="34" width="52" height="10" rx="6" fill="#402c3c"/>
          <circle cx="50" cy="62" r="6" fill="#402c3c"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="cheeky" style="--balloon-light:#fff;--balloon-mid:#fff0d6;--balloon-base:#ffd38f;--balloon-deep:#ffb85a;--wander-dur:13.3s">
        <div class="bubble-msg">giggle giggle</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="35" cy="40" r="6" fill="#402c3c"/><circle cx="65" cy="40" r="6" fill="#402c3c"/>
          <path d="M30 66 Q50 70 70 66" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
          <circle cx="30" cy="58" r="4" fill="#ff9dbb"/><circle cx="70" cy="58" r="4" fill="#ff9dbb"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="goofy" style="--balloon-light:#fff;--balloon-mid:#e0ffe6;--balloon-base:#a8ffbf;--balloon-deep:#73ff9f;--wander-dur:12.2s">
        <div class="bubble-msg">bloop bloop</div>
        <svg class="face" viewBox="0 0 100 100">
          <circle cx="35" cy="40" r="6" fill="#402c3c"/><circle cx="65" cy="40" r="6" fill="#402c3c"/>
          <path d="M40 62 q10 10 20 0" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
          <circle cx="50" cy="60" r="4" fill="#402c3c"/>
        </svg>
      </div>

      <div class="balloon wander" data-mood="starry" style="--balloon-light:#fff;--balloon-mid:#ffe8ff;--balloon-base:#e6c0ff;--balloon-deep:#c797ff;--wander-dur:14.1s">
        <div class="bubble-msg">my mams bithday today</div>
        <svg class="face" viewBox="0 0 100 100">
          <polygon points="50,34 54,42 63,42 56,48 58,56 50,52 42,56 44,48 37,42 46,42" fill="#e14986"/>
          <circle cx="30" cy="42" r="4" fill="#402c3c"/><circle cx="70" cy="42" r="4" fill="#402c3c"/>
          <path d="M30 66 Q50 72 70 66" stroke="#402c3c" stroke-width="5" fill="none" stroke-linecap="round"/>
        </svg>
      </div>
    </section>

    <!-- ‚ÄúHappy Birthday My MOON‚Äù chat bubble -->
    <div class="chat" id="chat" aria-live="polite">
      <div class="chat__title">Happy Birthday ‚ÄúMy MOON‚Äù</div>
      <div class="chat__sub">Wishing you endless smiles, soft light, and all the sweetest moments.</div>
    </div>

    <!-- Cake area -->
    <section class="cake-area" aria-label="Birthday cake">
      <div class="cake" id="cake">
        <div class="cake__stand"></div>
        <div class="cake__plate"></div>
        <div class="cake__body">
          <div class="cake__frost"></div>
        </div>
        <div class="candles" id="candles">
          <div class="candle"><div class="flame"></div></div>
          <div class="candle"><div class="flame"></div></div>
          <div class="candle"><div class="flame"></div></div>
        </div>
        <div class="knife" id="knife">
          <div class="blade"></div><div class="handle"></div>
        </div>
        <div class="wedge" id="wedge"></div>
      </div>
    </section>

    <!-- CTA -->
    <div class="cta" id="cta">
      <button class="btn">SPECIAL CAKE FOR YOU</button>
    </div>

    <!-- Dialogue panel -->
    <div class="dialogue" id="dialogue"></div>
  </main>

  <!-- Bottom controls -->
  <nav class="controls" aria-label="Controls">
    <button class="btn ghost" id="btnStory">Play story</button>
    <button class="btn ghost" id="btnShowCake">Show cake</button>
    <button class="btn secondary" id="btnBalloons">Gather balloons</button>
    <button class="btn" id="btnBlow">Blow candles</button>
    <button class="btn" id="btnMic">Mic blowing: Off</button>
    <button class="btn" id="btnCut">Cut cake</button>
    <button class="btn ghost" id="btnReset">Reset</button>
  </nav>

  <script>
    // --- INTRO SEQUENCE LOGIC ---
    const introOverlay = document.getElementById('intro-overlay');
    const btnStartIntro = document.getElementById('btn-start-intro');
    const introContent = document.getElementById('intro-content');
    const countDisplay = document.getElementById('count-display');
    const happySound = document.getElementById('sound-happy');

    // 1. User clicks "Click for Surprise"
    btnStartIntro.addEventListener('click', () => {
      btnStartIntro.style.display = 'none';
      introContent.style.display = 'block'; // Show text and smiley
      
      // Try to play music immediately on user interaction
      happySound.volume = 0.5;
      happySound.play().catch(e => console.log("Audio waiting for stronger trigger"));

      // 2. Start Countdown 1 to 5
      let currentNum = 1;
      countDisplay.textContent = currentNum;
      
      const interval = setInterval(() => {
        currentNum++;
        if (currentNum <= 5) {
          countDisplay.textContent = currentNum;
        } else {
          // 3. Finish sequence
          clearInterval(interval);
          introOverlay.style.animation = 'fadeOverlay 1s forwards';
          setTimeout(() => {
            introOverlay.style.display = 'none';
            // Start main scene
            startMainScene();
          }, 1000);
        }
      }, 1000);
    });

    function startMainScene() {
      spawnConfetti(80);
      gatherBalloons();
      happySound.play(); // Ensure music is playing
    }

    // --- YOUR ORIGINAL LOGIC BELOW (No deletions) ---
    const blowSound = document.getElementById('sound-blow');
    const popSound = document.getElementById('sound-pop');

    // Elements
    const balloons = document.getElementById('balloons');
    const cake = document.getElementById('cake');
    const candles = document.getElementById('candles');
    const chat = document.getElementById('chat');
    const cta = document.getElementById('cta');
    const confetti = document.getElementById('confetti');
    const messages = document.getElementById('messages');
    const knife = document.getElementById('knife');
    const wedge = document.getElementById('wedge');
    const dialogueBox = document.getElementById('dialogue');

    const btnStory = document.getElementById('btnStory');
    const btnShowCake = document.getElementById('btnShowCake');
    const btnBalloons = document.getElementById('btnBalloons');
    const btnBlow = document.getElementById('btnBlow');
    const btnCut = document.getElementById('btnCut');
    const btnReset = document.getElementById('btnReset');
    const btnMic = document.getElementById('btnMic');

    // Cute messages including your lines
    const quotes = [
      "My moon, my calm","Precious girl, precious day","You glow in my sky","Soft light, loud laughter","Sweet as your smile",
      "You are my favorite poem","The gentlest kind of magic","Pink skies and you","Heart full, hands warm","Hug-shaped moments",
      "Sparkle, always","Bloom softly, shine boldly","My favorite person","Sugar, stars, and you","You make time feel kind",
      "Forever my moon","Hold my hand, keep my heart","Sweetest soul, brightest eyes","Your laugh is confetti","You are my home",
      "my cutiee my wiffyyy","my swityyy","my mams bithday today","my mams bithday to day"
    ];

    // Storyline with your playful spellings
    const story = [
      {who:"Happy", text:"we floatting for someone specal‚Ä¶ my mams bithday today"},
      {who:"Love", text:"my cutiee my wiffyyy. my swityyy ‚Äî you glow like moon"},
      {who:"Winky", text:"okay okay, surpise comeing, keep eyes shinyyy"},
      {who:"Surprised", text:"is that‚Ä¶ cade with candle? make a wishhh"},
      {who:"Cheeky", text:"my mams bithday to day ‚Äî blow blow blow!"},
      {who:"All", text:"Happy Birthday ‚ÄúMy MOON‚Äù"}
    ];

    // Confetti
    function spawnConfetti(count=60){
      confetti.innerHTML = "";
      const colors = [getVar('--confetti1'),getVar('--confetti2'),getVar('--confetti3'),getVar('--confetti4')];
      for(let i=0;i<count;i++){
        const p = document.createElement('div');
        p.className = 'piece';
        p.style.left = Math.random()*100 + '%';
        p.style.top = (-Math.random()*40) + 'px';
        p.style.background = colors[i % colors.length];
        const dur = 4 + Math.random()*3;
        p.style.animationDuration = dur + 's';
        p.style.animationDelay = (Math.random()*2) + 's';
        p.style.transform = `translateY(-40px) rotate(${Math.random()*360}deg)`;
        confetti.appendChild(p);
      }
    }
    function getVar(name){ return getComputedStyle(document.documentElement).getPropertyValue(name).trim(); }

    // Background floating messages
    function spawnMessages(batch=10){
      for(let i=0;i<batch;i++){
        const m = document.createElement('div');
        m.className = 'msg';
        m.textContent = quotes[Math.floor(Math.random()*quotes.length)];
        m.style.left = Math.random()*90 + '%';
        m.style.bottom = (10 + Math.random()*60) + '%';
        m.style.animationDelay = (Math.random()*4) + 's';
        messages.appendChild(m);
        setTimeout(()=> m.remove(), 8000);
      }
    }
    const msgInterval = setInterval(()=> spawnMessages(4), 3500);

    // Core actions
    function showCake(){
      cake.style.display = 'block';
      cta.style.display = 'block';
      spawnConfetti(70);
      spawnMessages(10);
      balloons.classList.add('gather');
      setTimeout(()=> { chat.style.display = 'block'; }, 700);
    }
    function gatherBalloons(){
      balloons.classList.add('gather');
      spawnMessages(6);
    }
    function resetScene(){
      candles.querySelectorAll('.flame').forEach(f=>{ f.classList.remove('off'); });
      chat.style.display = 'none';
      cake.style.display = 'none';
      cta.style.display = 'none';
      balloons.classList.remove('gather');
      knife.style.display = 'none';
      wedge.style.display = 'none';
      cake.classList.remove('cutting','slice-out');
      dialogueBox.style.display = 'none'; dialogueBox.innerHTML = '';
      spawnConfetti(40);
    }
    function blowCandles(){
      candles.querySelectorAll('.flame').forEach(f=> f.classList.add('off'));
      blowSound.play(); // Fix sound bug
      spawnConfetti(80);
      spawnMessages(8);
      sayLine({who:"All", text:"Happy Birthday ‚ÄúMy MOON‚Äù"});
      // balloons cheer and change message temporarily
      cheerBalloons();
    }

    // Realistic cutting
    let cutting = false;
    function cutCake(){
      if(!cake.style.display || cake.style.display==='none'){ showCake(); }
      if(cutting) return;
      cutting = true;
      cake.classList.add('cutting');
      knife.style.display = 'block';
      setTimeout(()=>{
        cake.classList.remove('cutting');
        cake.classList.add('slice-out');
        wedge.style.display = 'block';
        spawnConfetti(60);
        bounceBalloons();
        setTimeout(()=> { cutting = false; }, 1800);
      }, 1700);
    }
    function bounceBalloons(){
      balloons.querySelectorAll('.balloon').forEach(b=>{
        b.style.animation = 'none';
        b.offsetHeight; // reflow
        b.style.animation = 'float 0.9s ease-in-out 2';
      });
    }

    // Balloon wandering tweaks: randomize duration and bubble text pulsing
    function randomizeWander(){
      balloons.querySelectorAll('.balloon').forEach(b=>{
        const dur = (10 + Math.random()*5).toFixed(1) + 's';
        b.style.setProperty('--wander-dur', dur);
        const bubble = b.querySelector('.bubble-msg');
        if(bubble){
          bubble.style.animation = `popmsg ${ (2 + Math.random()*2).toFixed(1) }s ease-in-out infinite`;
        }
      });
    }
    const popStyle = document.createElement('style');
    popStyle.textContent = `
      @keyframes popmsg{
        0%,100%{transform:translateX(-50%) translateY(0); opacity:.95}
        50%{transform:translateX(-50%) translateY(-4px); opacity:1}
      }
    `;
    document.head.appendChild(popStyle);

    // Balloons cheer: update bubble messages
    function cheerBalloons(){
      balloons.querySelectorAll('.balloon').forEach(b=>{ // Fix: Removed .bubble-msg selector to allow finding sub-element
         popSound.play();
      });
      balloons.querySelectorAll('.balloon .bubble-msg').forEach(b=>{
        b.textContent = 'HAPPY BIRTHDAY MY MOON';
      });
      setTimeout(()=>{
        const lines = ["my mams bithday today","my mams bithday to day","my cutiee my wiffyyy","my swityyy","we cool we party","giggle giggle"];
        balloons.querySelectorAll('.balloon .bubble-msg').forEach(b=>{
          b.textContent = lines[Math.floor(Math.random()*lines.length)];
        });
      }, 2200);
    }

    // Dialogue utilities
    function sayLine(line){
      dialogueBox.style.display = 'block';
      const el = document.createElement('div');
      el.className = 'line';
      el.innerHTML = `<span class="who">${line.who}:</span> ${line.text}`;
      dialogueBox.appendChild(el);
      dialogueBox.scrollTop = dialogueBox.scrollHeight;
    }
    function playStory(){
      resetScene(); showCake(); gatherBalloons();
      let i=0;
      const step = ()=> {
        if(i < story.length){
          sayLine(story[i]);
          i++;
          setTimeout(step, 1600);
        } else {
          setTimeout(()=> blowCandles(), 1200);
          setTimeout(()=> sayLine({who:"Winky", text:"now slice the cade, sweetiee"}), 2200);
          setTimeout(()=> cutCake(), 3400);
        }
      };
      setTimeout(step, 800);
    }

    // Microphone blowing support
    let micOn = false, mediaStream=null, audioCtx=null, analyser=null, dataArray=null, blowTriggered=false;
    async function toggleMic(){
      if(micOn){
        micOn = false; btnMic.textContent = 'Mic blowing: Off';
        if(mediaStream){ mediaStream.getTracks().forEach(t=> t.stop()); mediaStream=null; }
        if(audioCtx){ audioCtx.close(); audioCtx=null; }
        analyser=null; dataArray=null; return;
      }
      try{
        mediaStream = await navigator.mediaDevices.getUserMedia({ audio: true });
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const source = audioCtx.createMediaStreamSource(mediaStream);
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 2048;
        source.connect(analyser);
        dataArray = new Uint8Array(analyser.fftSize);
        micOn = true; btnMic.textContent = 'Mic blowing: On';
        monitorBlow();
      }catch(err){
        btnMic.textContent = 'Mic blown: Unavailable';
        console.warn('Mic permission or availability issue', err);
      }
    }
    function monitorBlow(){
      if(!micOn || !analyser) return;
      analyser.getByteTimeDomainData(dataArray);
      let sum=0;
      for(let i=0;i<dataArray.length;i++){
        const v = (dataArray[i]-128)/128; sum += v*v;
      }
      const rms = Math.sqrt(sum/dataArray.length);
      const threshold = 0.08;
      if(rms > threshold && !blowTriggered){
        blowTriggered = true;
        blowCandles();
        sayLine({who:"Cheeky", text:"that‚Äôs a perfect wish-blow!"});
        setTimeout(()=> blowTriggered=false, 1500);
      }
      requestAnimationFrame(monitorBlow);
    }

    // Buttons
    btnStory.addEventListener('click', playStory);
    btnShowCake.addEventListener('click', showCake);
    btnBalloons.addEventListener('click', gatherBalloons);
    btnBlow.addEventListener('click', blowCandles);
    btnCut.addEventListener('click', cutCake);
    btnReset.addEventListener('click', resetScene);
    btnMic.addEventListener('click', toggleMic);

    // Initial ambiance
    spawnConfetti(40); spawnMessages(6); randomizeWander();
    // Interaction spawns more messages and re-randomizes wander
    ['click','keydown'].forEach(evt=> document.addEventListener(evt, ()=> { spawnMessages(3); randomizeWander(); }));
  </script>
</body>
</html>